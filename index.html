<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style> circle {fill: lightblue; stroke: black;} </style>
<style> path {stroke: black;}</style>
<style> h1 {text-align: center;} </style>
<body onload='init()'>
<h1>SURVIVING THE TITANIC</h1>
Please click a button below to drill-down into the survival data.
<svg width=600 height=600>
</svg>
<script>
async function init() {
////////////////////////////////////////////////////////////////////////////////////

// FINAL VERSION

const data = await d3.csv('https://hromadka.github.io/data/titanicdatabase_curated.csv');
//var data = [4,8,15,16,23,42];
var arc = d3.arc().innerRadius(0).outerRadius(100);

//console.log(data);

// .size and .length not working?
function getMapSize(x) {
    var len = 0;
    for (var count in x) {
            len++;
    }
    return len;
}

//.rollup(function(ids) {
//    return ids.length; 
//})

// D3 v5
// below works correctly for counting Gender
var color = ['pink','lightblue','lightyellow','lightgreen','lightcyan','violet'];
//const grouped = d3.nest().key(function (d){return d.Gender;}).rollup(function(d){return d.length;}).entries(data);

// below works correctly for counting Survived (of Total)
const grouped = d3.nest().key(function (d){return d.Survived;}).rollup(function(d){return d.length;}).entries(data);
// below did NOT work correctly
//const grouped = d3.nest().key(function (d){return d.Survived;}).rollup(function(d){return d3.sum(d,function(g){return g.value;});}).entries(data);

//      console.log("ArrayData :", grouped);
//      console.log("ArrayData[0] :", grouped[0]);
//      console.log("ArrayData[1] :", grouped[1]);
//		console.log("ArrayData_length", getMapSize(grouped) );
		console.log("grouped[0] detail:",grouped[0].value);  // <-- this returns length correctly
		console.log("grouped[1] detail:",grouped[1].value);  // <-- this returns length correctly
		
// D3 v6
// const grouped = d3.rollup(data, v => v.length, d => d.Gender)  



//var pie = d3.pie();
//var pie = d3.pie().value(function(d) { return d.Gender; });
// I know this is wrong, but it seems to work!
var pie = d3.pie().value(function(d,i) { return grouped[i].value; })
var data_ready = pie(d3.entries(grouped))


//console.log(data_ready);

// set the dimensions and margins of the graph
var margin = 50,
    width = 500,
    height = 500;
/*
  var xScale = d3.scaleLog().base(10)
    .domain([10,150])
    .range([ 0, (width-(2*margin)) ]);

  var yScale = d3.scaleLog().base(10)
    .domain([10,150])
    .range([height - margin, 0]);
*/

// append the svg object to the body of the page
var svg = d3.select('svg')
  .append("g")
    .attr("transform",
          "translate(" + 3*margin + "," + 3*margin + ")");


svg.selectAll("path")
.data(pie(data_ready))
.enter().append("path")
.attr("d", arc )
.attr("fill", function(d, i) { return color[i]; })
;

/*
  svg.selectAll("circle")
    .data(data)
    .enter().append("circle")
    .attr("cx", function (d) { return xScale(d.AverageCityMPG) } )
    .attr("cy", function (d) { return yScale(d.AverageHighwayMPG) } )
    .attr("r", function (d) { return parseInt(d.EngineCylinders)+2  } );


    // axes
    var xAxis = d3.axisBottom()
    	.scale(xScale)
        .tickValues([10,20,50,100])
    	.tickFormat(d3.format('~s'));

    var yAxis = d3.axisLeft()
    	.scale(yScale)
        .tickValues([10,20,50,100])
    	.tickFormat(d3.format('~s'));

    svg.append('g')
      	.attr('transform', 'translate(' + [0, 0] + ')')
      	.call(yAxis);

    svg.append('g')
      	.attr('transform', 'translate(' + [0, height-margin] + ')')
      	.call(xAxis);
*/
////////////////////////////////////////////////////////////////////
}
</script>
</body>
</html>
